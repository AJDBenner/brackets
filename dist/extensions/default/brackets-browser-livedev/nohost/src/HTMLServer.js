define(function(require,exports,module){"use strict";var BaseServer=brackets.getModule("LiveDevelopment/Servers/BaseServer").BaseServer,LiveDevelopmentUtils=brackets.getModule("LiveDevelopment/LiveDevelopmentUtils"),BlobUtils=brackets.getModule("filesystem/impls/filer/BlobUtils"),Filer=brackets.getModule("filesystem/impls/filer/BracketsFiler"),Content=brackets.getModule("filesystem/impls/filer/lib/content"),Rewriter=brackets.getModule("filesystem/impls/filer/lib/HTMLRewriter");function HTMLServer(config){config=config||{};BaseServer.call(this,config)}HTMLServer.prototype=Object.create(BaseServer.prototype);HTMLServer.prototype.constructor=HTMLServer;HTMLServer.prototype.pathToUrl=function(path){return BlobUtils.getUrl(path)};HTMLServer.prototype.urlToPath=function(url){return BlobUtils.getFilename(url)};HTMLServer.prototype.start=function(){this.fs=Filer.fs()};HTMLServer.prototype.stop=function(){this.fs=null};HTMLServer.prototype.canServe=function(localPath){if(localPath===this._pathResolver(localPath)){return false}if(localPath.match(/\/$/)){return true}return LiveDevelopmentUtils.isStaticHtmlFileExt(localPath)};HTMLServer.prototype.add=function(liveDocument){if(liveDocument.setInstrumentationEnabled){liveDocument.setInstrumentationEnabled(true)}BaseServer.prototype.add.call(this,liveDocument)};HTMLServer.prototype.serveLiveDoc=function(url,callback){var path=BlobUtils.getFilename(url);var liveDocument=this._liveDocuments[path];Rewriter.rewrite(path,liveDocument.getResponseData().body,function(err,html){if(err){callback(err);return}var url=Content.toURL(html,"text/html");callback(null,url)})};exports.HTMLServer=HTMLServer});